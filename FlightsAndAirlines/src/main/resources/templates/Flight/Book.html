<!DOCTYPE html> <!-- Declares the document as HTML5 -->
<html xmlns:th="http://www.thymeleaf.org"> <!-- Enables Thymeleaf dynamic data binding -->
<head>
    <meta charset="UTF-8"> <!-- Sets character encoding -->
    <title>Booking Successful</title> <!-- Tab title -->
    <style>
        body { 
            background-color: #0d0d0d; /* Dark theme background */
            color: #fff; /* White text for contrast */
            font-family: 'Arial', sans-serif; /* Modern clean font */
            display: flex; /* Flexbox for centering */
            flex-direction: column; /* Vertical stacking of content */
            align-items: center; /* Center horizontally */
            justify-content: center; /* Center vertically */
            height: 100vh; /* Full viewport height */
            margin: 0; /* Remove default margins */
            overflow: hidden; /* Prevents scrollbars during confetti animation */
        }

        /* Container for the flight ticket aesthetic */
        .ticket-rect {
            width: 800px; /* Fixed width for ticket shape */
            height: 250px; /* Fixed height for ticket shape */
            background: #fff; /* White ticket background */
            color: #333; /* Dark text for ticket details */
            display: flex; /* Splits ticket into Main and Stub sections */
            border: 1px solid #ddd; /* Subtle border */
            position: relative; /* Base for layering */
            box-shadow: 0 10px 50px rgba(0,0,0,0.5); /* Deep shadow for 3D effect */
        }

        .ticket-main {
            flex: 2; /* Main section takes 2/3 of the width */
            padding: 30px; /* Internal spacing */
            border-right: 2px dashed #999; /* Dashed line to simulate a tear-off stub */
        }

        .ticket-stub {
            flex: 1; /* Stub section takes 1/3 of the width */
            background: #faf6f2; /* Soft warm background for the stub */
            padding: 30px; /* Internal spacing */
            display: flex; /* Flexbox for stub content */
            flex-direction: column; /* Vertical alignment */
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */
        }

        .congrats {
            font-size: 4rem; /* Large impact heading */
            font-weight: 900; /* Extra bold */
            color: #ffa733; /* Orange highlight color */
            margin-bottom: 20px; /* Space above ticket */
            text-transform: uppercase; /* All caps for celebration */
        }

        h2 { 
            margin: 0; /* Removes default spacing */
            color: #ff8c00; /* Theme orange color */
        }

        .label { 
            font-size: 10px; /* Small descriptor text */
            color: #888; /* Muted grey color */
            text-transform: uppercase; /* Uniform small caps */
            margin: 0; /* Tight spacing */
        }

        .value { 
            font-size: 1.5rem; /* Large readable data text */
            font-weight: bold; /* Bold data */
            margin-bottom: 10px; /* Space between rows */
        }

        canvas { 
            position: absolute; /* Overlays the entire screen */
            top: 0; 
            left: 0; 
            pointer-events: none; /* Allows clicking through the confetti to ticket */
            z-index: 999; /* Keeps confetti on the topmost layer */
        }
    </style>
</head>
<body>

    <!-- Main success heading -->
    <h1 class="congrats">BOOKED!</h1>

    <div class="ticket-rect">
        <div class="ticket-main">
            <!-- Dynamically displays the Airline Name -->
            <h2 th:text="${flight.enterprise}">QATAR AIRWAYS</h2>

            <div style="display: flex; justify-content: space-between; margin-top: 30px;">
                <div>
                    <p class="label">From</p>
                    <!-- Dynamically displays source city and departure date -->
                    <p class="value" th:text="${flight.source}">HYDERABAD</p>
                    <p th:text="${flight.departureDate}">2026-01-24</p>
                </div>

                <!-- Flight icon decoration -->
                <div style="font-size: 2rem;">✈</div>

                <div style="text-align: right;">
                    <p class="label">To</p>
                    <!-- Dynamically displays destination city and arrival date -->
                    <p class="value" th:text="${flight.destination}">DOHA</p>
                    <p th:text="${flight.arrivalDate}">2026-01-24</p>
                </div>
            </div>
        </div>

        <div class="ticket-stub">
            <p class="label">Fare Paid</p>
            <!-- Displays currency symbol concatenated with flight price -->
            <h2 style="color: #ff8c00;" th:text="'₹' + ${flight.flightPrice}">₹45000</h2>

            <p class="label" style="margin-top: 20px;">Flight ID</p>
            <!-- Displays the unique Flight identifier -->
            <p th:text="'#FL' + ${flight.flightId}">#FL1</p>
        </div>
    </div>

    <!-- Drawing area for the confetti/cracker effect -->
    <canvas id="celebrationCanvas"></canvas>

    <script>
        // Confetti Engine Setup
        const canvas = document.getElementById('celebrationCanvas');
        const ctx = canvas.getContext('2d'); // Access drawing context

        // Make canvas full-screen
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = []; // Array to store individual confetti pieces
        const colors = ['#ff8c00', '#ffa733', '#ffb84d', '#ffffff']; // Theme-consistent colors

        // Function to generate a burst of particles at a specific coordinate
        function createCrackerBurst(x, y) {
            for (let i = 0; i < 40; i++) {
                particles.push({
                    x: x,
                    y: y,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 6 + 2,
                    speedX: (Math.random() - 0.5) * 15, // Horizontal velocity
                    speedY: (Math.random() - 0.5) * 15, // Vertical velocity
                    gravity: 0.2, // Force pulling particles down
                    life: 1.0 // Initial opacity
                });
            }
        }

        // Animation loop function
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear previous frame

            particles.forEach((p, index) => {
                p.x += p.speedX; // Apply horizontal speed
                p.y += p.speedY; // Apply vertical speed
                p.speedY += p.gravity; // Apply gravity effect
                p.life -= 0.015; // Fade out slowly

                ctx.fillStyle = p.color; // Set particle color
                ctx.globalAlpha = p.life; // Set particle transparency
                ctx.fillRect(p.x, p.y, p.size, p.size); // Draw the square particle

                // Remove dead particles from memory
                if (p.life <= 0) particles.splice(index, 1);
            });

            requestAnimationFrame(update); // Call next frame
        }

        // Triggers the animation sequence when the page loads
        window.onload = function () {
            update(); // Start the loop

            // Initial center burst
            createCrackerBurst(canvas.width / 2, canvas.height / 2);

            // Repeat random bursts for a short period
            let count = 0;
            let interval = setInterval(() => {
                createCrackerBurst(Math.random() * canvas.width, Math.random() * canvas.height);
                count++;
                if (count > 15) clearInterval(interval); // Stop after 15 additional bursts
            }, 300);
        };
    </script>

</body>
</html>
